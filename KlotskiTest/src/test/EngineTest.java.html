<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>EngineTest.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">SupportTest (3) (4 set 2023 18:50:32)</a> &gt; <a href="../../index.html" class="el_group">KlotskiTest</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">test</a> &gt; <span class="el_source">EngineTest.java</span></div><h1>EngineTest.java</h1><pre class="source lang-java linenums">package test;

import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

import application.Engine;
import application.MoveInfo;

import javafx.scene.input.KeyCode;
import javafx.scene.input.KeyEvent;
import javafx.scene.layout.GridPane;
import javafx.scene.shape.Rectangle;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;

import java.nio.file.Path;
import java.nio.file.Paths;

import java.util.HashMap;
import java.util.Map;
import java.util.Stack;

import static org.junit.jupiter.api.Assertions.*;

<span class="nc" id="L31">public class EngineTest {</span>

    private Map&lt;Rectangle, Integer[]&gt; initialPositions;
    private Map&lt;Rectangle, Integer[]&gt; currentPositions;
    private Stack&lt;MoveInfo&gt; moveHistory;
    private Rectangle[] pieces;
    private GridPane board;
    
    
    @BeforeEach
    void setUp() {
        // Initialize test data, including initialPositions, currentPositions, moveHistory, board and alert
<span class="nc" id="L43">        initialPositions = new HashMap&lt;&gt;();</span>
<span class="nc" id="L44">        currentPositions= new HashMap&lt;&gt;();</span>
<span class="nc" id="L45">        moveHistory = new Stack&lt;&gt;();</span>
<span class="nc" id="L46">        board = new GridPane();</span>
<span class="nc" id="L47">        pieces = new Rectangle[3]; // Create an array of 3 pieces for testing</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">        for (int i = 0; i &lt; pieces.length; i++) {</span>
<span class="nc" id="L49">            pieces[i] = new Rectangle();</span>
        }
        
<span class="nc" id="L52">    }</span>

    /**
     * Test with this scenario:
     * selectedPiece is a small piece in position [1,1]
     * Test try to move it up by one with key W
     * selectedPiece should move without problems
     */
    
    @Test
    void testMovePieceWithLegalMove() {
        // Create a selectedPiece Rectangle
<span class="nc" id="L64">		Rectangle piece1 = new Rectangle(1,1,100,100);</span>
<span class="nc" id="L65">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L66">        Rectangle selectedPiece = piece1;</span>
<span class="nc" id="L67">        initialPositions.put(piece1, new Integer[] {1,1});</span>

        // Set its initial position on the grid
<span class="nc" id="L70">        GridPane.setRowIndex(selectedPiece, 1);</span>
<span class="nc" id="L71">        GridPane.setColumnIndex(selectedPiece, 1);</span>

        // Create a KeyEvent for moving the piece
<span class="nc" id="L74">        KeyEvent event = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.W, false, false, false, false);</span>
        // Call the movePiece method and check the result
<span class="nc" id="L76">        Engine result = Engine.movePiece(event, selectedPiece, board, initialPositions, false, moveHistory, 0);</span>

        // Assert that the move was successful (legal) and that the position is updated
<span class="nc" id="L79">        assertTrue(result.isLegal());</span>
<span class="nc" id="L80">        assertEquals(0, GridPane.getRowIndex(selectedPiece));</span>
<span class="nc" id="L81">        assertEquals(1, GridPane.getColumnIndex(selectedPiece)); </span>
<span class="nc" id="L82">    }</span>
    
    @Test
    void testMovePieceAithLegalMove() {
        // Create a selectedPiece Rectangle
<span class="nc" id="L87">		Rectangle piece1 = new Rectangle(1,1,100,100);</span>
<span class="nc" id="L88">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L89">        Rectangle selectedPiece = piece1;</span>
<span class="nc" id="L90">        initialPositions.put(piece1, new Integer[] {1,1});</span>

        // Set its initial position on the grid
<span class="nc" id="L93">        GridPane.setRowIndex(selectedPiece, 1);</span>
<span class="nc" id="L94">        GridPane.setColumnIndex(selectedPiece, 1);</span>

        // Create a KeyEvent for moving the piece
<span class="nc" id="L97">        KeyEvent event = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.A, false, false, false, false);</span>
        // Call the movePiece method and check the result
<span class="nc" id="L99">        Engine result = Engine.movePiece(event, selectedPiece, board, initialPositions, false, moveHistory, 0);</span>

        // Assert that the move was successful (legal) and that the position is updated
<span class="nc" id="L102">        assertTrue(result.isLegal());</span>
<span class="nc" id="L103">        assertEquals(1, GridPane.getRowIndex(selectedPiece));</span>
<span class="nc" id="L104">        assertEquals(0, GridPane.getColumnIndex(selectedPiece)); </span>
<span class="nc" id="L105">    }</span>
    
    @Test
    void testMovePieceSithLegalMove() {
        // Create a selectedPiece Rectangle
<span class="nc" id="L110">		Rectangle piece1 = new Rectangle(1,1,100,100);</span>
<span class="nc" id="L111">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L112">        Rectangle selectedPiece = piece1;</span>
<span class="nc" id="L113">        initialPositions.put(piece1, new Integer[] {1,1});</span>

        // Set its initial position on the grid
<span class="nc" id="L116">        GridPane.setRowIndex(selectedPiece, 1);</span>
<span class="nc" id="L117">        GridPane.setColumnIndex(selectedPiece, 1);</span>

        // Create a KeyEvent for moving the piece
<span class="nc" id="L120">        KeyEvent event = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.S, false, false, false, false);</span>
        // Call the movePiece method and check the result
<span class="nc" id="L122">        Engine result = Engine.movePiece(event, selectedPiece, board, initialPositions, false, moveHistory, 0);</span>

        // Assert that the move was successful (legal) and that the position is updated
<span class="nc" id="L125">        assertTrue(result.isLegal());</span>
<span class="nc" id="L126">        assertEquals(2, GridPane.getRowIndex(selectedPiece));</span>
<span class="nc" id="L127">        assertEquals(1, GridPane.getColumnIndex(selectedPiece)); </span>
<span class="nc" id="L128">    }</span>
    
    @Test
    void testMovePieceDithLegalMove() {
        // Create a selectedPiece Rectangle
<span class="nc" id="L133">		Rectangle piece1 = new Rectangle(1,1,100,100);</span>
<span class="nc" id="L134">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L135">        Rectangle selectedPiece = piece1;</span>
<span class="nc" id="L136">        initialPositions.put(piece1, new Integer[] {1,1});</span>

        // Set its initial position on the grid
<span class="nc" id="L139">        GridPane.setRowIndex(selectedPiece, 1);</span>
<span class="nc" id="L140">        GridPane.setColumnIndex(selectedPiece, 1);</span>

        // Create a KeyEvent for moving the piece
<span class="nc" id="L143">        KeyEvent event = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.D, false, false, false, false);</span>
        // Call the movePiece method and check the result
<span class="nc" id="L145">        Engine result = Engine.movePiece(event, selectedPiece, board, initialPositions, false, moveHistory, 0);</span>

        // Assert that the move was successful (legal) and that the position is updated
<span class="nc" id="L148">        assertTrue(result.isLegal());</span>
<span class="nc" id="L149">        assertEquals(1, GridPane.getRowIndex(selectedPiece));</span>
<span class="nc" id="L150">        assertEquals(2, GridPane.getColumnIndex(selectedPiece)); </span>
<span class="nc" id="L151">    }</span>
    
    @Test
    void testMovePieceQithLegalMove() {
        // Create a selectedPiece Rectangle
<span class="nc" id="L156">		Rectangle piece1 = new Rectangle(1,1,100,100);</span>
<span class="nc" id="L157">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L158">        Rectangle selectedPiece = piece1;</span>
<span class="nc" id="L159">        initialPositions.put(piece1, new Integer[] {1,1});</span>

        // Set its initial position on the grid
<span class="nc" id="L162">        GridPane.setRowIndex(selectedPiece, 1);</span>
<span class="nc" id="L163">        GridPane.setColumnIndex(selectedPiece, 1);</span>

        // Create a KeyEvent for moving the piece
<span class="nc" id="L166">        KeyEvent event = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.Q, false, false, false, false);</span>
        // Call the movePiece method and check the result
<span class="nc" id="L168">        Engine result = Engine.movePiece(event, selectedPiece, board, initialPositions, false, moveHistory, 0);</span>

        // Assert that the move was successful (legal) and that the position is updated
<span class="nc" id="L171">        assertFalse(result.isLegal());</span>
 
<span class="nc" id="L173">    }</span>

    /**
     * Test with this scenario:
     * selectedPiece is a small piece in position [0,0]
     * Test try to move it up by one with key W
     * selectedPiece should not move because the move is out of the grid bounds
     */
    
    @Test
    void testMovePieceWithIllegalMove() {
        // Create a selectedPiece Rectangle 
<span class="nc" id="L185">        Rectangle selectedPiece = new Rectangle(100, 100);</span>

        // Set its initial position on the grid
<span class="nc" id="L188">        GridPane.setRowIndex(selectedPiece, 0);</span>
<span class="nc" id="L189">        GridPane.setColumnIndex(selectedPiece, 0);</span>

        // Create a KeyEvent for moving the piece
<span class="nc" id="L192">        KeyEvent event = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.W, false, false, false, false);</span>

        // Call the movePiece method and check the result
<span class="nc" id="L195">        Engine result = Engine.movePiece(event, selectedPiece, board, initialPositions, false, moveHistory, 0);</span>

        // Assert that the move was illegal, and the position remains unchanged
<span class="nc" id="L198">        assertFalse(result.isLegal());</span>
<span class="nc" id="L199">        assertEquals(0, GridPane.getRowIndex(selectedPiece)); </span>
<span class="nc" id="L200">        assertEquals(0, GridPane.getColumnIndex(selectedPiece));</span>
<span class="nc" id="L201">    }</span>

    /**
     * Test with this scenario:
     * Two pieces in two different positions stored in map initialPositions
     * Positions are changed
     * Reset method should bring the pieces to their initial position
     */
    
    @Test
    void testReset() {
        // Create Rectangle objects and add them to the board with initial positions
<span class="nc" id="L213">        Rectangle piece1 = new Rectangle();</span>
<span class="nc" id="L214">        Rectangle piece2 = new Rectangle();</span>
        
        // Set initial positions
<span class="nc" id="L217">        Integer[] initialPosition1 = {1, 1};</span>
<span class="nc" id="L218">        Integer[] initialPosition2 = {2, 2};</span>
        
<span class="nc" id="L220">        initialPositions.put(piece1, initialPosition1);</span>
<span class="nc" id="L221">        initialPositions.put(piece2, initialPosition2);</span>
        
<span class="nc" id="L223">        GridPane.setRowIndex(piece1, 3);</span>
<span class="nc" id="L224">        GridPane.setColumnIndex(piece1, 3);</span>
<span class="nc" id="L225">        GridPane.setRowIndex(piece2, 4);</span>
<span class="nc" id="L226">        GridPane.setColumnIndex(piece2, 4);</span>

        // Call the reset method
<span class="nc" id="L229">        Engine.reset(initialPositions);</span>

        // Check if the positions have been reset correctly
<span class="nc" id="L232">        assertEquals(initialPosition1[0], GridPane.getRowIndex(piece1));</span>
<span class="nc" id="L233">        assertEquals(initialPosition1[1], GridPane.getColumnIndex(piece1));</span>
<span class="nc" id="L234">        assertEquals(initialPosition2[0], GridPane.getRowIndex(piece2));</span>
<span class="nc" id="L235">        assertEquals(initialPosition2[1], GridPane.getColumnIndex(piece2));</span>
<span class="nc" id="L236">    }</span>
    
    /**
     * Test to simulate scenario:
     * moveHistory not empty
     * undo should restore the previous position of the piece
     */
    
    @Test
    void testUndoWithNonEmptyMoveHistory() {
        // Create a Rectangle object and set its initial position on the board
<span class="nc" id="L247">        Rectangle piece = new Rectangle();</span>
<span class="nc" id="L248">        GridPane.setRowIndex(piece, 1);</span>
<span class="nc" id="L249">        GridPane.setColumnIndex(piece, 1);</span>

        // Create a MoveInfo object representing a move
<span class="nc" id="L252">        MoveInfo moveInfo = new MoveInfo(piece, 2, 2);</span>

        // Push the move onto the moveHistory stack
<span class="nc" id="L255">        moveHistory.push(moveInfo);</span>

        // Call the undo method
<span class="nc" id="L258">        Engine.undo(moveHistory);</span>

        // Check if the undo correctly restores the previous position
<span class="nc" id="L261">        assertEquals(2, GridPane.getRowIndex(piece));</span>
<span class="nc" id="L262">        assertEquals(2, GridPane.getColumnIndex(piece));</span>
<span class="nc" id="L263">        assertTrue(moveHistory.isEmpty()); // Ensure the move is removed from the history</span>
<span class="nc" id="L264">    }</span>

    /**
     * Test to simulate this scenario:
     * moveHistory empty
     * undo should have no effect on the position of the piece
     */
    
    @Test
    void testUndoWithEmptyMoveHistory() {
        // Create a Rectangle object and set its initial position on the board
<span class="nc" id="L275">        Rectangle piece = new Rectangle();</span>
<span class="nc" id="L276">        GridPane.setRowIndex(piece, 1);</span>
<span class="nc" id="L277">        GridPane.setColumnIndex(piece, 1);</span>

        // Call the undo method
<span class="nc" id="L280">        Engine.undo(moveHistory);</span>

        // Check if the undo does not change the position and moveHistory remains empty
<span class="nc" id="L283">        assertEquals(1, GridPane.getRowIndex(piece));</span>
<span class="nc" id="L284">        assertEquals(1, GridPane.getColumnIndex(piece));</span>
<span class="nc" id="L285">        assertTrue(moveHistory.isEmpty());</span>
<span class="nc" id="L286">    }</span>
    
    @Test
    void testSave() throws IOException {
        // Create test data for currentPositions
<span class="nc" id="L291">		Rectangle piece1 = new Rectangle(100,100);</span>
<span class="nc" id="L292">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L293">		Rectangle piece2 = new Rectangle(100,100);</span>
<span class="nc" id="L294">		piece2.setId(&quot;piece2&quot;);</span>
<span class="nc" id="L295">		currentPositions.put(piece1, new Integer[] {1,2});</span>
<span class="nc" id="L296">		currentPositions.put(piece2, new Integer[] {3,3});</span>
        
        // Define the real directory where the file will be created
<span class="nc" id="L299">        String currentDirectory = System.getProperty(&quot;user.dir&quot;);</span>
<span class="nc" id="L300">        String directoryPath = currentDirectory + File.separator + &quot;src&quot; + File.separator + &quot;Save-Config&quot; + File.separator; </span>

        // Call the save method
<span class="nc" id="L303">        Engine.save(board, currentPositions, 42);</span>

        // Construct the file path to check if the file exists
<span class="nc" id="L306">        Path savedFilePath = Paths.get(directoryPath, &quot;board_state.json&quot;);</span>
<span class="nc" id="L307">        File savedFile = savedFilePath.toFile();</span>

        // Verify that the JSON file was created
<span class="nc" id="L310">        assertTrue(savedFile.exists());</span>

        // Read the JSON content from the saved file
<span class="nc" id="L313">        JsonObject jsonObject = readJsonFromFile(savedFile);</span>

        // Verify the content of the saved JSON
<span class="nc" id="L316">        assertEquals(42, jsonObject.get(&quot;numberOfMoves&quot;).getAsInt());</span>
<span class="nc" id="L317">        JsonObject initialPositionsObject = jsonObject.getAsJsonObject(&quot;initialPositions&quot;);</span>
<span class="nc" id="L318">        assertEquals(2, initialPositionsObject.get(piece1.getId()).getAsJsonObject().get(&quot;x&quot;).getAsInt());</span>
<span class="nc" id="L319">        assertEquals(1, initialPositionsObject.get(piece1.getId()).getAsJsonObject().get(&quot;y&quot;).getAsInt());</span>
<span class="nc" id="L320">        assertEquals(3, initialPositionsObject.get(piece2.getId()).getAsJsonObject().get(&quot;x&quot;).getAsInt());</span>
<span class="nc" id="L321">        assertEquals(3, initialPositionsObject.get(piece2.getId()).getAsJsonObject().get(&quot;y&quot;).getAsInt());</span>
<span class="nc" id="L322">    }</span>

    @Test
    public void testLoad() throws IOException {
<span class="nc" id="L326">        String jsonFilePath = &quot;src/Save-Config/board_stateEx.json&quot;;</span>
        
<span class="nc" id="L328">		Rectangle piece1 = new Rectangle(100,200);</span>
<span class="nc" id="L329">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L330">		Rectangle piece2 = new Rectangle(100,200);</span>
<span class="nc" id="L331">		piece2.setId(&quot;piece2&quot;);</span>
		
<span class="nc" id="L333">		initialPositions.put(piece1, new Integer[] {1,2});</span>
<span class="nc" id="L334">		initialPositions.put(piece2, new Integer[] {3,3});</span>
		
		// Call the load method
<span class="nc" id="L337">		int numberOfMoves = Engine.load(jsonFilePath, board, initialPositions);</span>

		// Assert the expected values
<span class="nc" id="L340">		assertEquals(42, numberOfMoves);</span>

		// Assert the positions of pieces loaded from the JSON
<span class="nc" id="L343">		assertEquals(0, (int) initialPositions.get(piece1)[0]);</span>
<span class="nc" id="L344">		assertEquals(0, (int) initialPositions.get(piece1)[1]);</span>
<span class="nc" id="L345">		assertEquals(2, (int) initialPositions.get(piece2)[0]);</span>
<span class="nc" id="L346">		assertEquals(0, (int) initialPositions.get(piece2)[1]);</span>

<span class="nc" id="L348">    }</span>

    @Test
    public void testLoadConfiguration() throws IOException {
<span class="nc" id="L352">        String jsonFilePath = &quot;src/Save-Config/config1.json&quot;;</span>
        
<span class="nc" id="L354">		Rectangle piece1 = new Rectangle(100,200);</span>
<span class="nc" id="L355">		piece1.setId(&quot;piece1&quot;);</span>
<span class="nc" id="L356">		Rectangle piece2 = new Rectangle(100,100);</span>
<span class="nc" id="L357">		piece2.setId(&quot;piece2&quot;);</span>
		
<span class="nc" id="L359">		initialPositions.put(piece1, new Integer[] {0,0});</span>
<span class="nc" id="L360">		initialPositions.put(piece2, new Integer[] {0,3});</span>
		
		//call the loadConfiguration method
		
<span class="nc" id="L364">		Engine.loadConfiguration(jsonFilePath, board, initialPositions);</span>

		// Assert the positions of pieces loaded from the JSON
<span class="nc" id="L367">		assertEquals(0, (int) initialPositions.get(piece1)[0]);</span>
<span class="nc" id="L368">		assertEquals(0, (int) initialPositions.get(piece1)[1]);</span>
<span class="nc" id="L369">		assertEquals(0, (int) initialPositions.get(piece2)[0]);</span>
<span class="nc" id="L370">		assertEquals(3, (int) initialPositions.get(piece2)[1]);</span>

<span class="nc" id="L372">    }</span>
    
    //Helper method to read form json File
    private JsonObject readJsonFromFile(File file) throws IOException {
<span class="nc" id="L376">        StringBuilder jsonContent = new StringBuilder();</span>
<span class="nc" id="L377">        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {</span>
            String line;
<span class="nc bnc" id="L379" title="All 2 branches missed.">            while ((line = reader.readLine()) != null) {</span>
<span class="nc" id="L380">                jsonContent.append(line);</span>
            }
        }
<span class="nc" id="L383">        return JsonParser.parseString(jsonContent.toString()).getAsJsonObject();</span>
    }
    

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span>SupportTest (3) (4 set 2023 18:50:32)</div></body></html>